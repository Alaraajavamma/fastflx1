#!/bin/bash

unlocked() {
# Check the current value of auto-maximize
auto_maximize=$(gsettings get sm.puri.phoc auto-maximize)

# If it's true, run the notify-send and wait for the response
if [[ "$auto_maximize" == "false" ]]; then
    response=$(notify-send --icon="/home/furios/.git/fastflx1/files/fastflx1.svg" \
                           --expire-time=0 \
                           "Manage multitask" \
                           "Select multitask action" \
                           --action="Stop" \
                           --action="MoveLeft" \
                           --action="MoveRigth" \
                           --action="Max" \
                           --action="Min" \
                           2>&1)

    # Process the response
    case "$response" in
        "0")
            wtype -M win -P L -m win
            gsettings set sm.puri.phoc auto-maximize true
            wlr-randr --output "HWCOMPOSER-1" --scale 3.0 
            ;;
        "1")
            wtype -M win -P left -m win
            ;;
        "2")
            wtype -M win -P right -m win
            ;;
        "3")
            wtype -M win -P up -m win
            ;;
        "4")
            wtype -M win -P down -m win
            ;;
        *)
            echo "No valid action selected or dismissed."
            ;;
    esac
else
    # Add the same code in the else block
    response=$(notify-send --icon="/home/furios/.git/fastflx1/files/fastflx1.svg" \
                           --expire-time=0 \
                           "Start multitask" \
                           "Select preferred method" \
                           --action="Start default" \
                           --action="Start 175%" \
                           --action="Start 200%" \
                           2>&1)

    # Process the response
    case "$response" in
        "0")
            gsettings set sm.puri.phoc auto-maximize false
            wlr-randr --output "HWCOMPOSER-1" --scale 1.5
            ;;
        "1")
            gsettings set sm.puri.phoc auto-maximize false
            wlr-randr --output "HWCOMPOSER-1" --scale 1.75
            ;;
        "2")
            gsettings set sm.puri.phoc auto-maximize false
            wlr-randr --output "HWCOMPOSER-1" --scale 2.0
            ;;
        *)
            echo "No valid action selected or dismissed."
            ;;
    esac
fi
}

# Function to toggle the flashlight
locked() {
    current_brightness=$(dbus-send --session --dest=org.droidian.Flashlightd --print-reply=literal \
                    /org/droidian/Flashlightd org.freedesktop.DBus.Properties.Get \
                    string:org.droidian.Flashlightd string:Brightness | awk '{print $3}')

    if [ "$current_brightness" -eq 0 ]; then
        # Turn on the flashlight
        dbus-send --session --dest=org.droidian.Flashlightd --type=method_call /org/droidian/Flashlightd org.droidian.Flashlightd.SetBrightness uint32:31
        echo "Flashlight turned on"
	sleep 20
        dbus-send --session --dest=org.droidian.Flashlightd --type=method_call /org/droidian/Flashlightd org.droidian.Flashlightd.SetBrightness uint32:0
    else
        # Turn off the flashlight
        dbus-send --session --dest=org.droidian.Flashlightd --type=method_call /org/droidian/Flashlightd org.droidian.Flashlightd.SetBrightness uint32:0
        echo "Flashlight turned off"
    fi
}


# Identify the session ID
session_id=$(loginctl list-sessions | grep $(whoami) | awk 'NR==2 {print $1}')
# Check lock status of the session
idle_hint=$(loginctl show-session $session_id -p LockedHint)

if [[ "$idle_hint" == *"yes"* ]]; then
    locked
    echo "Locked"
elif [[ "$idle_hint" == *"no"* ]]; then
    unlocked
    echo "Unlocked"
else 
    echo "Failed to determine lockscreen state"
fi
