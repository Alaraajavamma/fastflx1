#!/bin/bash

# Get the current value of the keyboard scale
current_scale=$(gsettings get sm.puri.Squeekboard keyboard-scale)
notify-send "Your current scale is $current_scale" --icon="/home/furios/.git/fastflx1/files/fastflx1.svg"

# Create options for wofi menu from 0.7 to 1.3, with close option at the bottom
OPTIONS=""
for i in $(seq 7 13); do
    scale=$(echo "scale=1; $i/10" | bc)  # Generate scale values in the range of 0.7 to 1.3
    OPTIONS+="Scale to $scale\n"
done
OPTIONS+="Close"  # Place 'Close' at the bottom

# Display the wofi menu with the current value included in the info
SELECTION=$(echo -e "$OPTIONS" | wofi -d --normal-window --width=100% --height=50%)

# If the user selects "Close", exit
if [[ "$SELECTION" == "Close" ]]; then
    exit 0
fi

# Extract the selected scale value
if [[ "$SELECTION" =~ Scale\ to\ ([0-9.]+) ]]; then
    input="${BASH_REMATCH[1]}"
else
    echo "No valid input provided. Exiting."
    exit 1
fi

# Debugging: Print the input value (optional)
printf 'INPUT: %s\n' "$input"

# Set the scale value using gsettings and check for success
if gsettings set sm.puri.Squeekboard keyboard-scale "$input"; then
    notify-send "Scale set to $input successfully."
else
    notify-send "Failed to set scale to $input."
fi