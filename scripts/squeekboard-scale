#!/bin/bash

is_overview_active() {
    gdbus call --session \
        --dest org.gnome.Shell \
        --object-path /org/gnome/Shell \
        --method org.freedesktop.DBus.Properties.Get \
        org.gnome.Shell OverviewActive | grep -q "true"
}

# Function to start wofi
start_wofi() {
        wofi_kill &
# Get the current value of the keyboard scale
current_scale=$(gsettings get sm.puri.Squeekboard scale-in-vertical-screen-orientation)
notify-send "Your current scale is $current_scale" --icon="/home/furios/.git/fastflx1/files/fastflx1.svg"

# Options for the FastFLX1 tweaks menu
OPTIONS="1. Scale Squeekboard to 1.00\n2. Scale Squeekboard to 1.10\n3. Scale Squeekboard to 1.15\n4. Scale Squeekboard to 1.20\n5. Scale Squeekboard to 1.25\n6. Scale Squeekboard to 1.30\n7. Scale Squeekboard to 1.35\n8. Quit"

# Display the menu and capture the user's selection using wofi
SELECTION=$(echo -e "$OPTIONS" | wofi -d --prompt "Select an option:" --lines 8)

# Execute a command based on the selection
case "$SELECTION" in
    "1. Scale Squeekboard to 1.00")
        gsettings set sm.puri.Squeekboard scale-in-vertical-screen-orientation 1.00
        ;;
    "2. Scale Squeekboard to 1.10")
        gsettings set sm.puri.Squeekboard scale-in-vertical-screen-orientation 1.10
        ;;
    "3. Scale Squeekboard to 1.15")
        gsettings set sm.puri.Squeekboard scale-in-vertical-screen-orientation 1.15
        ;;
    "4. Scale Squeekboard to 1.20")
        gsettings set sm.puri.Squeekboard scale-in-vertical-screen-orientation 1.20
        ;;
    "5. Scale Squeekboard to 1.25")
        gsettings set sm.puri.Squeekboard scale-in-vertical-screen-orientation 1.25
        ;;
    "6. Scale Squeekboard to 1.30")
        gsettings set sm.puri.Squeekboard scale-in-vertical-screen-orientation 1.30
        ;;
    "7. Scale Squeekboard to 1.35")
        gsettings set sm.puri.Squeekboard scale-in-vertical-screen-orientation 1.35
        ;;
    "8. Quit")
        exit 0
        ;;
    *)
        echo "Invalid selection. Exiting."
        pkill -x feh
        exit 1
        ;;
esac }

wofi_kill () {
dbus-monitor "interface='org.freedesktop.DBus.Properties',member='PropertiesChanged',path='/org/gnome/Shell'" | \
while read -r line; do
    # Check if the OverviewActive property has changed
    if echo "$line" | grep -q "string \"OverviewActive\""; then
        # Read the next line for the boolean value
        read -r next_line
        if echo "$next_line" | grep -q "boolean true"; then
            if pgrep -x wofi > /dev/null; then
          pkill -x wofi
        fi
            break
        fi
    fi
done
}

   if is_overview_active; then
        pkill -x wofi
        wtype -M win -k Super_l
        start_wofi
    else
        start_wofi
    fi
